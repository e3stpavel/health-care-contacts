---
import ApplicationLayout from '~/layouts/ApplicationLayout.astro'
import type { Facility } from '~/schemas/facility'

const response = await fetch(`${import.meta.env.API}/facilities`)

if (!response.ok)
  throw new Error(`Request failed with status ${response.status}`)

const facilities = await response.json() as Array<Facility>

---

<ApplicationLayout>
  <table>
    <thead>
      <tr>
        <td>Description</td>
        <td>Type</td>
        <td>Type Description</td>
        <td>Contacts</td>
        <td>Actions</td>
      </tr>
    </thead>
    <tbody>
      {
        facilities.map(facility => (
          <tr>
            <td>{ facility.description }</td>
            <td class="capitalize">
              { facility.type.replace(/([a-z])([A-Z])/g, '$1 $2') }
            </td>
            <td>{ facility.facilityTypeDescription }</td>
            <td>{ facility.contacts.length }</td>
            <td>
              <a href={`/facilities/${facility.id}`}>Edit</a>
            </td>
          </tr>
        ))
      }
    </tbody>
  </table>
</ApplicationLayout>
